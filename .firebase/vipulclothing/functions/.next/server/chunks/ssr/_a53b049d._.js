module.exports=[47283,(a,b,c)=>{b.exports=a.r(96665)},25376,a=>{"use strict";var b=a.i(87924);let c=()=>(0,b.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},children:(0,b.jsx)("div",{className:"spinner-border text-light",role:"status",style:{width:"3rem",height:"3rem"},children:(0,b.jsx)("span",{className:"visually-hidden",children:"Loading..."})})});var d=a.i(6704),e=a.i(47283),f=a.i(72131),g=a.i(50944);let h={src:a.i(81980).default,width:150,height:150,blurWidth:0,blurHeight:0};var i=a.i(38246);a.i(30485);var j=a.i(70896),k=a.i(20706);a.i(9912);var l=a.i(94318);a.i(69387);var m=a.i(60574);a.s(["default",0,()=>{let a=(0,g.useSearchParams)().get("mode"),n=(0,g.useRouter)(),o=(0,l.getFunctions)(k.app),[p,q]=(0,f.useState)({}),[r,s]=(0,f.useState)([]),[t,u]=(0,f.useState)(0),[v,w]=(0,f.useState)(0),[x,y]=(0,f.useState)(!1),[z,A]=(0,f.useState)(""),[B,C]=(0,f.useState)(!1),[D,E]=(0,f.useState)(0),[F,G]=(0,f.useState)({}),[H,I]=(0,f.useState)(!1),[J,K]=(0,f.useState)("online"),[L,M]=(0,f.useState)(!1),[N,O]=(0,f.useState)({orderId:"df",paymentId:null}),[P,Q]=(0,f.useState)(!1),[R,S]=(0,f.useState)(!1),[T,U]=(0,f.useState)(!0),[V,W]=(0,f.useState)({phone:"",street:"",pincode:"",state:"",city:"",notes:"",coupon:""});(0,f.useEffect)(()=>{let a=(0,j.getAuth)();(0,j.onAuthStateChanged)(a,a=>{a?(console.log(a),q(a)):(q(null),console.log("user not logged in "))})},[]),(0,f.useEffect)(()=>{let b;if(p){if(Q(!0),"buy-now"===a){let a=sessionStorage.getItem("buyNow"),b=a?JSON.parse(a):null;s(b?[b]:[]),u(b?b.price:0),Q(!1)}else{let a=(0,m.collection)(k.db,`users/${p.uid}/cart`);b=(0,m.onSnapshot)(a,a=>{let b=a.docs.map(a=>({id:a.id,...a.data()}));s(b);let c=b.reduce((a,b)=>a+(b.price||0),0);console.log("subtotal is",c),u(c),Q(!1)})}return()=>{b&&b()}}},[p,a]);let X=async()=>{try{let a=(0,m.collection)(k.db,`users/${p.uid}/cart`),b=(await (0,m.getDocs)(a)).docs.map(a=>(0,m.deleteDoc)((0,m.doc)(k.db,`users/${p.uid}/cart`,a.id)));await Promise.all(b)}catch(a){console.error(a)}};(0,f.useEffect)(()=>{E(t-v>=599?0:50)},[t,v]);let Y=a=>{W({...V,[a.target.name]:a.target.value}),G({...F,[a.target.name]:""})},Z=async a=>{let b=(0,m.collection)(k.db,`users/${a}/orders`);return(await (0,m.getDocs)(b)).empty},$=async()=>{A("");let a=(0,j.getAuth)().currentUser;a?"WELCOME5"===V.coupon?await Z(a.uid)?(w(.05*t),y(!0)):(A("WELCOME5 can only be used for your first order."),W({...V,coupon:""}),w(0),y(!1)):(A("Invalid coupon code."),W({...V,coupon:""}),w(0),y(!1)):A("Please login to apply a coupon.")},_=async()=>{let a;if(!R)return void alert("Payment system is still loading. Please wait a moment.");if(a={},/^[6-9]\d{9}$/.test(V.phone)||(a.phone="Enter a valid 10-digit Indian phone number."),/^\d{6}$/.test(V.pincode)||(a.pincode="Enter a valid 6-digit pincode."),V.street||(a.street="Street address is required."),V.city||(a.city="City is required."),V.state||(a.state="State is required."),B||(a.agreed="You must agree to the Terms and Conditions."),G(a),0!==Object.keys(a).length)return;if(!p)return void alert("Please login first.");Q(!0);let c=(0,m.doc)(k.db,"users",p.uid),e=r.map(a=>({productId:a.productId,quantity:a.quantity||1})),f={userId:p.uid,phone:V.phone,address:{street:V.street,city:V.city,state:V.state,pincode:V.pincode},notes:V.notes||"",products:[...r],subtotal:t,discount:v,shipping:D,totalAmount:t-v+D,razorpayOrderId:null,paymentStatus:"Pending",status:"Order Requested",createdAt:(0,m.serverTimestamp)()},g=await (0,m.addDoc)((0,m.collection)(k.db,"orders"),f),h=g.id;if(await (0,m.addDoc)((0,m.collection)(k.db,`users/${p.uid}/orders`),{docRef:g,date:(0,m.serverTimestamp)()}),"online"===J){let a=(0,l.httpsCallable)(o,"orderWala"),c=await a({products:e}),f=c.data;console.log("from the server",c.data);let i={key:"rzp_test_WuIdTI6w0lb8jL",amount:f.amount,currency:"INR",name:"Kumar Fashion Store",description:"Payment for your order",image:"/logo.png",order_id:f.id,handler:async function(a){Q(!1),O({orderId:g.id,paymentId:a.razorpay_payment_id}),M(!0),console.log("Payment successful:",a),await (0,m.updateDoc)((0,m.doc)(k.db,"orders",h),{paymentStatus:"Paid",razorpayPaymentId:a.razorpay_payment_id,razorpayOrderId:f.id}),setTimeout(()=>{n.push("/orders",{state:{orderId:h,paymentId:a.razorpay_payment_id}})},1e4)},modal:{ondismiss:async function(){await (0,m.updateDoc)((0,m.doc)(k.db,"orders",h),{paymentStatus:"Pending payment failed",razorpayOrderId:f.id,retryTimestamp:(0,m.serverTimestamp)()}),Q(!1),d.default.custom(a=>(0,b.jsxs)("div",{className:"toaster bg-warning text-white px-5 py-2  shadow-sm d-flex justify-content-between align-items-center ",style:{fontFamily:"Jost Variable",fontSize:"12px",width:""},children:[(0,b.jsx)("span",{className:"text-center",children:"You didn't complete the payment.Please try again."}),(0,b.jsx)("button",{className:"btn btn-sm btn-light ms-3",onClick:()=>d.default.dismiss(a.id),style:{fontSize:"12px"},children:"Close"})]}),{duration:3e3})}},prefill:{name:p.displayName||"Customer",email:p.email,contact:V.phone},notes:{address:`${V.street}, ${V.city}, ${V.state}`},theme:{color:"#3399cc"}};new window.Razorpay(i).open()}else try{for(let a of r){let b=(a.price||0)-v+D,d={...a,phone:V.phone,address:{street:V.street,pincode:V.pincode,state:V.state,city:V.city},notes:V.notes,status:"Order Requested",date:(0,m.serverTimestamp)(),totalAmount:b,user:c,paymentStatus:"Pending (COD)"},e=await (0,m.addDoc)((0,m.collection)(k.db,"orders"),d);await (0,m.addDoc)((0,m.collection)(k.db,`users/${p.uid}/orders`),{docRef:e,date:(0,m.serverTimestamp)()})}console.log(g.id),console.log(g),H&&X(),Q(!1),M(!0),O({orderId:g.id}),setTimeout(()=>{navigate("/orders",{state:{orderId:h}})},1e4)}catch(a){Q(!1),console.error("Error placing COD order: ",a),d.default.custom(a=>(0,b.jsxs)("div",{className:"toaster bg-error text-white px-5 py-2  shadow-sm d-flex justify-content-between align-items-center ",style:{fontFamily:"Jost Variable",fontSize:"12px",width:""},children:[(0,b.jsx)("span",{className:"text-center",children:"Error in Placing the order. Please try again."}),(0,b.jsx)("button",{className:"btn btn-sm btn-light ms-3",onClick:()=>d.default.dismiss(a.id),style:{fontSize:"12px"},children:"Close"})]}),{duration:3e3})}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.default,{src:"https://checkout.razorpay.com/v1/checkout.js",strategy:"afterInteractive",onLoad:()=>{console.log("Razorpay script loaded"),S(!0)}}),(0,b.jsxs)("div",{className:"container mt-5",children:[(0,b.jsx)("h3",{style:{fontFamily:"Jost Variable"},className:"mb-4",children:"Checkout"}),(0,b.jsxs)("div",{className:"row",children:[(0,b.jsx)("div",{className:"col-md-7",children:(0,b.jsxs)("form",{style:{fontFamily:"Jost Variable"},children:[(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("label",{className:"form-label",children:"Phone Number (for tele-verification)"}),(0,b.jsx)("input",{type:"tel",className:"form-control",name:"phone",value:V.phone,onChange:Y}),F.phone&&(0,b.jsx)("div",{className:"text-danger",children:F.phone})]}),(0,b.jsx)("h5",{className:"mt-4",children:"Shipping Address"}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("label",{className:"form-label",children:"Street Address"}),(0,b.jsx)("input",{type:"text",className:"form-control",name:"street",value:V.street,onChange:Y}),F.street&&(0,b.jsx)("div",{className:"text-danger",children:F.street})]}),(0,b.jsxs)("div",{className:"row",children:[(0,b.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,b.jsx)("label",{className:"form-label",children:"Pincode"}),(0,b.jsx)("input",{type:"text",className:"form-control",name:"pincode",value:V.pincode,onChange:Y}),F.pincode&&(0,b.jsx)("div",{className:"text-danger",children:F.pincode})]}),(0,b.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,b.jsx)("label",{className:"form-label",children:"State"}),(0,b.jsxs)("select",{className:"form-select",name:"state",value:V.state,onChange:Y,children:[(0,b.jsx)("option",{value:"",children:"Select State"}),["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Delhi","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal"].map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),F.state&&(0,b.jsx)("div",{className:"text-danger",children:F.state})]}),(0,b.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,b.jsx)("label",{className:"form-label",children:"City"}),(0,b.jsx)("input",{type:"text",className:"form-control",name:"city",value:V.city,onChange:Y}),F.city&&(0,b.jsx)("div",{className:"text-danger",children:F.city})]})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("label",{className:"form-label",children:"Order Notes (Optional)"}),(0,b.jsx)("textarea",{className:"form-control",name:"notes",rows:"3",value:V.notes,onChange:Y})]})]})}),(0,b.jsx)("div",{style:{fontFamily:"Jost Variable"},className:"col-md-5",children:(0,b.jsxs)("div",{className:"card p-3 shadow-sm ",children:[(0,b.jsx)("div",{className:"d-flex ",children:r.length>0&&r.map((a,c)=>(0,b.jsx)("img",{className:"m-1",src:a.photo[0],alt:`Product ${c+1}`,style:{width:"90px",height:"auto",objectFit:"cover",marginBottom:"10px"}},c))}),(0,b.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,b.jsx)("span",{children:"Subtotal:"}),(0,b.jsxs)("strong",{children:["₹",t]})]}),x&&(0,b.jsxs)("div",{className:"d-flex justify-content-between text-success",children:[(0,b.jsx)("span",{children:"Coupon Discount:"}),(0,b.jsxs)("strong",{children:["- ₹",v.toFixed(0)]})]}),(0,b.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,b.jsx)("span",{children:"Shipping:"}),(0,b.jsx)("strong",{children:0===D?"Free":`₹${D}`})]}),(0,b.jsxs)("div",{className:"d-flex justify-content-between mt-2",children:[(0,b.jsx)("span",{children:"Total:"}),(0,b.jsxs)("strong",{children:["₹",(t-v+D).toFixed(0)]})]}),(0,b.jsx)("hr",{}),(0,b.jsx)("h5",{children:"Apply Coupon"}),(0,b.jsxs)("div",{className:"input-group mb-1",children:[(0,b.jsx)("input",{type:"text",className:"form-control",name:"coupon",placeholder:"Enter coupon code",value:V.coupon,onChange:Y}),(0,b.jsx)("button",{className:"btn btn-outline-secondary",type:"button",onClick:$,children:"Apply"})]}),z&&(0,b.jsx)("div",{className:"text-danger",children:z}),(0,b.jsx)("hr",{}),(0,b.jsx)("h6",{children:"Payment Method"}),(0,b.jsxs)("div",{className:"form-check mb-3",children:[(0,b.jsx)("input",{className:"form-check-input",type:"radio",name:"paymentMethod",id:"cod",checked:"cod"===J,onChange:()=>K("cod"),readOnly:!0}),(0,b.jsx)("label",{className:"form-check-label",htmlFor:"cod",children:"Cash on Delivery (COD)"})]}),(0,b.jsxs)("div",{className:"form-check mb-3",children:[(0,b.jsx)("input",{className:"form-check-input",type:"radio",name:"paymentMethod",id:"cod",readOnly:!0,checked:"online"===J,onChange:()=>K("online")}),(0,b.jsx)("label",{className:"form-check-label",htmlFor:"cod",children:"Pay via UPI / Card / Netbanking"})]}),(0,b.jsxs)("div",{className:"form-check mb-3",children:[(0,b.jsx)("input",{className:"form-check-input",type:"checkbox",id:"terms",checked:B,onChange:a=>C(a.target.checked)}),(0,b.jsxs)("label",{className:"form-check-label",htmlFor:"terms",children:["I agree with"," ",(0,b.jsx)(i.default,{href:"/termsConditions",target:"_blank",children:"Terms and Conditions"})]}),F.agreed&&(0,b.jsx)("div",{className:"text-danger",children:F.agreed})]}),(0,b.jsx)("button",{className:"btn btn-primary w-100",onClick:_,children:R?"Processing...":"Pay Now"})]})})]})]}),L&&(0,b.jsx)("div",{children:(0,b.jsxs)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"#28a745",zIndex:9999,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",color:"white",textAlign:"center"},children:[(0,b.jsx)("img",{src:h,alt:"Success",style:{width:"",marginBottom:"20px"}}),(0,b.jsx)("h2",{children:"Payment Successful!"}),(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("h4",{className:"d-inline",children:"Order Id:"}),(0,b.jsxs)("p",{className:"d-inline",children:[" ",N.orderId]})," ",(0,b.jsx)("br",{}),N.paymentId&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h4",{className:"d-inline",children:"Payment Id: "})," ",(0,b.jsx)("p",{className:"d-inline",children:N.paymentId})]})]}),(0,b.jsxs)("div",{className:"mt-3",children:["cod"==J&&(0,b.jsx)(b.Fragment,{children:"Our team will contact you as soon as possible for tele-verification."}),(0,b.jsx)("p",{className:"",children:"Your order has been placed. Redirecting..."})]})]})}),(0,b.jsx)(d.Toaster,{position:"bottom-left"}),P&&(0,b.jsx)(c,{})]})}],25376)}];

//# sourceMappingURL=_a53b049d._.js.map